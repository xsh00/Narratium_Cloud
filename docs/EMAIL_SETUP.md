# 邮件服务配置说明

## 概述

Narratium 使用 Gmail SMTP 服务发送验证码邮件。要启用邮件功能，您需要配置 Gmail 应用专用密码。

## 配置步骤

### 1. 启用 Gmail 两步验证

1. 登录您的 Google 账户
2. 访问 [Google 账户安全设置](https://myaccount.google.com/security)
3. 在"登录 Google"部分，点击"两步验证"
4. 按照提示启用两步验证

### 2. 生成应用专用密码

1. 在两步验证页面，点击"应用专用密码"
2. 选择"邮件"应用
3. 点击"生成"
4. 复制生成的 16 位密码（格式如：abcd efgh ijkl mnop）

### 3. 配置环境变量

在项目根目录创建或编辑 `.env.local` 文件：

```env
# Gmail 配置
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-app-password
```

**重要说明：**
- `EMAIL_USER` 必须是您的完整 Gmail 地址
- `EMAIL_PASS` 是应用专用密码，不是您的 Gmail 登录密码
- 不要在代码中硬编码这些值，始终使用环境变量

### 4. 重启开发服务器

配置完成后，重启开发服务器：

```bash
npm run dev
# 或
pnpm dev
```

## 测试邮件功能

1. 访问登录页面：`http://localhost:3000/auth`
2. 尝试注册新用户
3. 检查邮箱是否收到验证码
4. 如果邮件发送失败，请检查配置和网络连接

## 常见问题

### 问题 1：邮件发送失败
**错误信息：** "邮件发送失败，请检查邮箱配置"

**解决方案：**
1. 确认已启用 Gmail 两步验证
2. 确认使用的是应用专用密码，不是登录密码
3. 检查 `.env.local` 文件中的配置是否正确
4. 确认 Gmail 账户没有被限制

### 问题 2：连接超时
**错误信息：** "邮件发送超时，请检查网络连接"

**解决方案：**
1. 检查网络连接是否正常
2. 尝试使用不同的网络环境
3. 检查防火墙设置是否阻止了 SMTP 连接
4. 确认 Gmail SMTP 服务器可访问

### 问题 3：认证失败
**错误信息：** "邮箱认证失败，请检查邮箱和密码配置"

**解决方案：**
1. 重新生成 Gmail 应用专用密码
2. 确认密码中没有多余的空格
3. 检查邮箱地址是否正确
4. 确认 Gmail 账户没有被锁定

### 问题 2：连接验证失败
**错误信息：** "邮件服务连接失败"

**解决方案：**
1. 检查网络连接
2. 确认 Gmail 账户设置正确
3. 尝试重新生成应用专用密码

### 问题 3：验证码收不到
**解决方案：**
1. 检查垃圾邮件文件夹
2. 确认邮箱地址输入正确
3. 等待几分钟，邮件可能有延迟

## 安全注意事项

1. **不要提交 `.env.local` 文件到版本控制**
2. **定期更换应用专用密码**
3. **使用强密码保护您的 Gmail 账户**
4. **在生产环境中使用更安全的邮件服务**

## 生产环境建议

在生产环境中，建议使用专业的邮件服务提供商：

- **SendGrid**
- **Mailgun**
- **Amazon SES**
- **Postmark**

这些服务提供更好的可靠性和安全性。

## 故障排除

如果仍然遇到问题，请检查：

1. **控制台日志**：查看服务器控制台的错误信息
2. **网络连接**：确认服务器可以访问 Gmail SMTP
3. **防火墙设置**：确保端口 587 或 465 未被阻止
4. **Gmail 设置**：确认账户没有被 Google 限制

## 联系支持

如果问题仍然存在，请提供以下信息：

1. 错误信息截图
2. 控制台日志
3. 邮件配置状态（隐藏敏感信息）
4. 使用的 Gmail 账户类型（个人/工作） 