# 邮件服务配置指南

## 概述

本系统使用 Gmail SMTP 服务发送验证码邮件。需要配置以下环境变量：

## 环境变量配置

在项目根目录创建 `.env.local` 文件，添加以下配置：

```env
# Gmail 邮件服务配置
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-app-password
```

## Gmail 应用专用密码设置

### 1. 启用两步验证

1. 登录您的 Gmail 账户
2. 访问 [Google 账户安全设置](https://myaccount.google.com/security)
3. 找到"两步验证"并启用

### 2. 生成应用专用密码

1. 在两步验证页面，找到"应用专用密码"
2. 点击"生成新的应用专用密码"
3. 选择应用类型：其他（自定义名称）
4. 输入名称：Narratium Cloud
5. 点击"生成"
6. 复制生成的16位密码（不包含空格）

### 3. 配置环境变量

将您的 Gmail 邮箱和生成的密码填入 `.env.local` 文件：

```env
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=abcd efgh ijkl mnop
```

**注意：**
- 不要使用您的 Gmail 登录密码
- 必须使用应用专用密码
- 密码中的空格会被自动忽略

## 测试邮件发送

1. 启动开发服务器：`npm run dev`
2. 访问：`http://localhost:3000/test-email`
3. 输入测试邮箱地址
4. 点击"发送测试验证码"
5. 检查邮箱是否收到验证码

## 常见问题

### 1. 认证失败错误

**错误信息：** `Invalid login: 535-5.7.8 Username and Password not accepted`

**解决方案：**
- 确保已启用两步验证
- 确保使用的是应用专用密码，不是登录密码
- 检查密码是否正确复制

### 2. 邮件发送超时

**错误信息：** `Connection timeout`

**解决方案：**
- 检查网络连接
- 确认 Gmail SMTP 服务可用
- 尝试使用其他网络环境

### 3. 邮件被标记为垃圾邮件

**解决方案：**
- 将发送邮箱添加到联系人
- 检查垃圾邮件文件夹
- 在 Gmail 设置中标记为"非垃圾邮件"

## 安全注意事项

1. **不要提交 `.env.local` 文件到版本控制**
2. **定期更换应用专用密码**
3. **使用强密码保护 Gmail 账户**
4. **监控邮件发送日志**

## 生产环境部署

在生产环境中，建议：

1. 使用专业的邮件服务（如 SendGrid、Mailgun）
2. 配置 SPF、DKIM、DMARC 记录
3. 设置邮件发送限制和监控
4. 使用环境变量管理敏感信息

## 故障排除

如果遇到问题，请检查：

1. 环境变量是否正确设置
2. Gmail 两步验证是否启用
3. 应用专用密码是否正确
4. 网络连接是否正常
5. 防火墙是否阻止 SMTP 连接

## 联系支持

如果问题仍然存在，请：

1. 检查控制台错误信息
2. 查看网络请求日志
3. 确认 Gmail 账户设置
4. 联系技术支持 